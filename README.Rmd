---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "figure/"
)

sapply(list.files("R", full.names = TRUE), source)
```

# maximal-room-squares

<!-- badges: start -->
<!-- badges: end -->

```{r find_maximal_room}
library(dplyr)
library(tictoc)

set.seed(55)

# the order of Room square we are looking for
n <- 10

# a data frame representing an empty Room square
# of the desired order
R <- expand_grid(row = 1:(n - 1), col = 1:(n - 1)) %>%
  mutate(first = as.integer(NA), second = as.integer(NA)) %>%
  pivot_longer(first:second)

# go through all of the pairs that haven't yet been
# used in R (all of them, in this case) and try to
# place them in an empty cell x. if a suitable x is
# found then update R.
tic()
for(p in not_used_pairs(R)) {
  
  E <- empty_cells(R)
  
  x <- NULL
  
  # iterate through empty cells in given order
  for(cell in E) {
    
    if(avail(R, p, cell)) {
      x <- cell
    }
    
  }
  
  # if one exists then update R by placing p in x
  if(!is.null(x))  {
    R <- update_(R, x, p)
  }
  
}
toc()
```

```{r is_maximal_room}
# is R a maximal partial Room square?
is_maximal_proom(R)
```

```{r plot, echo=FALSE, message=FALSE, fig.width=9, fig.height=9}
library(ggplot2)
library(glue)

nf <- n_filled_cells(R)
v <- volume(R)

ggplot(data = R %>% pivot_wider(), aes(col, row)) +
  geom_segment(data = grid_lines(n-1, n-1), aes(x = x, y = y, xend = xend, yend = yend), size = .1) +
  geom_text(data = R %>% pivot_wider() %>% filter(!is.na(first)), aes(label = paste(first, second, sep = ","))) +
  scale_y_reverse() +
  coord_fixed() + 
  theme_void() +
  theme(
    legend.position  = "none"
  ) +
  labs(
    title = glue("A maximal partial Room square of order {n}"),
    subtitle = glue("Number of filled cells: {nf}, Volume: {v}.")
  )
```

